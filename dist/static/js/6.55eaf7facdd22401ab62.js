webpackJsonp([6],{PybM:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=a("2hfY"),i=a("QUe6"),n=a("vLgD"),s=a("DEjr"),r=a.n(s);var l={updateMemo:function(t,e){var a=r.a.stringify({memo1:t,date:e});return Object(n.a)({url:"/memo/update",method:"post",data:a})},getMemo:function(t){var e=r.a.stringify({date:t});return Object(n.a)({url:"/memo/retrive",method:"post",data:e})}},c={name:"scheduler",data:function(){return{today:Object(o.b)(new Date),loading:!0,dialogVisiable:!1,dialogStatus:"create",pickerDate:Object(o.b)(new Date),customers:[],schedulerEvents:[],memo1:"",form:{event_id:"",memo:"",name:"",phone:"",hospital:"",bookTime:""},hospitalOptions:[{value:1,label:"世纪口腔"},{value:2,label:"艾雅口腔"},{value:3,label:"诊所3"}],rules:{name:[{required:!0,message:"请输入姓名",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"}],hospital:[{required:!0,message:"不能为空",trigger:"blur"}]}}},computed:{startHour:function(){return 8},stopHour:function(){return 21}},mounted:function(){this.initData()},watch:{form:function(){},pickerDate:function(){this.pickNewDate()}},methods:{resetForm:function(){this.form={event_id:"",memo:"",name:"",phone:"",hospital:"",bookTime:""}},createEvent:function(){var t=this;this.$refs.form.validate(function(e){e&&i.a.createDateEvents(t.form).then(function(e){t.$notify({title:"成功",message:"创建成功",type:"success",duration:2e3}),t.dialogVisiable=!1,t.getDateEvents(Object(o.b)(t.pickerDate))}).catch(function(t){return console.error(t)})})},updateEvent:function(){var t=this;this.$refs.form.validate(function(e){e&&i.a.updateDateEvent(t.form).then(function(e){t.$notify({title:"成功",message:"修改成功",type:"success",duration:2e3}),t.dialogVisiable=!1,t.getDateEvents(Object(o.b)(t.pickerDate))}).catch(function(t){return console.error(t)})})},handleAdd:function(t,e){var a=this;t<3&&(this.dialogVisiable=!0,this.dialogStatus="create",this.resetForm(),this.form.bookTime=Object(o.b)(this.pickerDate)+" "+e),this.$nextTick(function(){a.$refs.form.clearValidate()})},handleEdit:function(t){var e=this;this.form={event_id:t.event_id,memo:t.memo,name:t.customer.name,phone:t.customer.phone,hospital:t.hospital_id,bookTime:t.bookingTime},this.dialogStatus="update",this.dialogVisiable=!0,this.$nextTick(function(){e.$refs.form.clearValidate()})},pickNewDate:function(){this.loading=!0;var t=Object(o.b)(this.pickerDate);this.getDateEvents(t),this.getMemo(t)},initData:function(){this.getDateEvents(this.today),this.getMemo(this.today)},generateInitEvents:function(t,e){for(var a=[],o=t;o<=e;o++){var i,n=o;n<10?n="0"+n+":00":n+=":00",i={hour:n,events:[[],[],[]]},a.push(i)}return a},getDateEvents:function(t){var e=this;i.a.getDateEvents(t).then(function(t){var a=t.data,o=e.generateInitEvents(e.startHour,e.stopHour);for(var i in a){var n=a[i],s=parseInt(n.bookingTime.split(":"))-e.startHour,r=n.event.hospital_id;console.log("---"),console.log(n.bookingTime),console.log(o),console.log(s),o[s].events[r-1].push(n.event)}e.schedulerEvents=o,e.loading=!1})},customLabel:function(t){return t.phone+" - "+t.name},showToday:function(){this.pickerDate=this.today},previousDay:function(){this.pickerDate=Object(o.a)(this.pickerDate,-1)},nextDay:function(){this.pickerDate=Object(o.a)(this.pickerDate,1)},getMemo:function(t){var e=this;l.getMemo(t).then(function(t){e.memo1=t.data.memo1})},autoSave:function(){console.log("save");var t=Object(o.b)(this.pickerDate);l.updateMemo(this.memo1,t).then(function(t){console.log("oooook")})}}},u={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"memo"},[a("el-input",{attrs:{type:"textarea",autosize:"",placeholder:"请输入备忘"},on:{blur:t.autoSave},model:{value:t.memo1,callback:function(e){t.memo1=e},expression:"memo1"}})],1),t._v(" "),a("el-menu",{staticClass:"scheduler-nav",attrs:{mode:"horizontal","text-color":"#fff","background-color":"#409eff"}},[a("div",{staticClass:"date col"},[a("el-date-picker",{attrs:{type:"date",clearable:!1},on:{change:t.pickNewDate},model:{value:t.pickerDate,callback:function(e){t.pickerDate=e},expression:"pickerDate"}})],1),t._v(" "),a("div",{staticClass:"right-menu col"},[a("button",{staticClass:"btn",attrs:{type:"button"},on:{click:t.showToday}},[a("span",[t._v("显示今天")])]),t._v(" "),a("div",{staticClass:"arrow-group"},[a("button",{staticClass:"btn",attrs:{type:"button"},on:{click:t.previousDay}},[t._v(" <")]),t._v(" "),a("button",{staticClass:"btn",attrs:{type:"button"},on:{click:t.nextDay}},[t._v(" >")])])])]),t._v(" "),t.schedulerEvents?a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"scheduler-table"},[t._l(t.schedulerEvents,function(e){return[a("el-row",{staticClass:"event-row"},[a("el-col",{staticClass:"event-hour",attrs:{span:1}},[a("span",[t._v(t._s(e.hour))])]),t._v(" "),a("el-col",{staticClass:"hour-events",attrs:{span:23}},[a("div",{staticClass:"events"},[a("el-row",{staticStyle:{width:"100%",height:"100%"}},[t._l(e.events,function(o){return[a("el-col",{staticStyle:{height:"100%","border-right":"1px solid #CECECE"},attrs:{span:8}},[a("div",{staticStyle:{height:"100%"},on:{click:function(a){t.handleAdd(o.length,e.hour)}}},[a("el-row",[t._l(o,function(e){return[a("el-col",{staticClass:"event",attrs:{span:8}},[a("span",{class:"h"+e.hospital_id+"-event",on:{click:function(a){a.stopPropagation(),t.handleEdit(e)}}},[t._v(t._s(e.customer.name))])])]})],2)],1)])]})],2)],1)])],1)]}),t._v(" "),a("el-dialog",{attrs:{title:"预约表格",visible:t.dialogVisiable,width:"30%","close-on-click-modal":!0},on:{"update:visible":function(e){t.dialogVisiable=e},close:function(e){t.dialogVisiable=!1}}},[a("el-form",{ref:"form",attrs:{model:t.form,"label-position":"left","label-width":"80px",rules:t.rules}},[a("el-form-item",{staticStyle:{width:"300px"},attrs:{label:"姓名",prop:"name"}},[a("el-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),a("el-form-item",{staticStyle:{width:"300px"},attrs:{label:"手机号",prop:"phone"}},[a("el-input",{attrs:{value:"number"},model:{value:t.form.phone,callback:function(e){t.$set(t.form,"phone",e)},expression:"form.phone"}})],1),t._v(" "),a("el-form-item",{staticStyle:{width:"300px"},attrs:{label:"医院",prop:"hospital"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:t.form.hospital,callback:function(e){t.$set(t.form,"hospital",e)},expression:"form.hospital"}},t._l(t.hospitalOptions,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),a("el-form-item",{staticStyle:{width:"300px"},attrs:{label:"开始时间"}},[a("el-row",[a("el-col",{attrs:{span:24}},[t._v(t._s(t.form.bookTime))])],1)],1),t._v(" "),a("el-form-item",{staticStyle:{width:"300px"},attrs:{label:"备注"}},[a("el-input",{attrs:{"auto-complete":"off",type:"textarea"},model:{value:t.form.memo,callback:function(e){t.$set(t.form,"memo",e)},expression:"form.memo"}})],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisiable=!1}}},[t._v("取消")]),t._v(" "),"create"===t.dialogStatus?a("el-button",{attrs:{type:"success"},on:{click:t.createEvent}},[t._v("新建")]):a("el-button",{attrs:{type:"success"},on:{click:t.updateEvent}},[t._v("更改")])],1)],1)],2):t._e()],1)},staticRenderFns:[]};var m={name:"calendar",components:{Scheduler:a("Z0/y")(c,u,!1,function(t){a("XIji")},"data-v-061dbcee",null).exports}},d={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"calendar-container"},[e("scheduler")],1)},staticRenderFns:[]};var h=a("Z0/y")(m,d,!1,function(t){a("bCaY")},"data-v-351a3e0b",null);e.default=h.exports},XIji:function(t,e){},bCaY:function(t,e){}});
//# sourceMappingURL=6.55eaf7facdd22401ab62.js.map